<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Settings — Mālama Mana</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&family=Open+Sans&display=swap" rel="stylesheet">
  <!-- Main stylesheet -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- APP HEADER -->
  
  <header class="app-header">
  <div class="header-content">
    <div id="header-greeting">Aloha,</div>
    <h1>Mālama Mana</h1>
  </div>
</header>

  <!-- SETTINGS CONTENT -->
  <div class="app">
    <div class="card">
      <h2>Settings</h2>
      <form id="settings-form">
        <label>
          First Name:<br>
          <input type="text" id="profile-first-name" required>
        </label><br><br>
        <label>
          Last Name:<br>
          <input type="text" id="profile-last-name" required>
        </label><br><br>
        <label>
          Email:<br>
          <input type="email" id="profile-email" required>
        </label><br><br>
		<label>
  Password:<br>
  <input type="password" id="profile-password" placeholder="New password (leave blank to keep current)">
</label><br><br>
        <label>
          Phone:<br>
          <input type="tel" id="profile-phone">
        </label><br><br>
        <label>
<label>
  Location:<br>
  <input type="text" id="profile-location" placeholder="City, Country" autocomplete="off">
  <div id="location-suggestions" style="font-size: 0.85rem; color: #555;"></div>
</label><br><br>
<label>
  Latitude:<br>
  <input type="text" id="profile-lat" placeholder="Latitude" readonly>
</label><br><br>
<label>
  Longitude:<br>
  <input type="text" id="profile-lng" placeholder="Longitude" readonly>
</label><br><br>
 </div> <div>
        <button type="submit">Save</button>
        <button type="button" id="settings-logout">Logout</button>
      </form>
    </div>
  </div>

  <!-- BOTTOM NAVIGATION -->
  <nav class="bottom-nav">
    <a href="index.html">
      <!-- calendar icon -->
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
           stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
      <span>Dashboard</span>
    </a>
    <a href="#today">
      <!-- today icon -->
      <svg viewBox="0 0 24 24" fill="currentColor">
        <circle cx="12" cy="12" r="10"></circle>
      </svg>
      <span>Today</span>
    </a>
    <a href="#add">
      <!-- add icon -->
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
           stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      <span>Add</span>
    </a>
    <a href="#" id="more-button-settings">
      <!-- more icon -->
      <svg viewBox="0 0 24 24" fill="currentColor">
        <circle cx="5" cy="12" r="2"></circle>
        <circle cx="12" cy="12" r="2"></circle>
        <circle cx="19" cy="12" r="2"></circle>
      </svg>
      <span>More</span>
    </a>
  </nav>

  <!-- MORE POPUP MENU -->
  <div id="more-menu-settings" class="more-menu hidden">
    <button onclick="window.location.href='index.html'">Home</button>
    <button onclick="window.location.href='settings.html'">Settings</button>
  </div>
<!-- Firebase CDN Scripts -->
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js"></script>

<script>
  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyA6C65XgjxpN1a7IowyRaJxr7poqsYV9TA",
    authDomain: "malama-247ad.firebaseapp.com",
    projectId: "malama-247ad",
    storageBucket: "malama-247ad.firebasestorage.app",
    messagingSenderId: "83778882351",
    appId: "1:83778882351:web:599a8aebcc5ebd7b8eefda",
    measurementId: "G-3NS9NX3HPZ"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
</script>
  <!-- Inline Script to Wire the Popup -->
  <script src="app.js"></script>
  <script>
    const moreBtn = document.getElementById('more-button-settings');
    const moreMenu = document.getElementById('more-menu-settings');

    moreBtn.addEventListener('click', e => {
      e.preventDefault();
      moreMenu.classList.toggle('hidden');
    });

    document.addEventListener('click', e => {
      if (!moreMenu.contains(e.target) && !moreBtn.contains(e.target)) {
        moreMenu.classList.add('hidden');
      }
    });

    // Populate & Save Profile Data (reuse your existing logic)
    const current = localStorage.getItem('currentUser');
    const users   = JSON.parse(localStorage.getItem('users') || '{}');
    if (current && users[current]) {
      const p = users[current].profile;
      document.getElementById('profile-first-name').value = p.firstName || '';
      document.getElementById('profile-last-name').value  = p.lastName || '';
      document.getElementById('profile-email').value      = p.email || '';
      document.getElementById('profile-phone').value      = p.phone || '';
      document.getElementById('profile-location').value   = p.location || '';
	  document.getElementById('profile-lat').value = p.lat || '';
		document.getElementById('profile-lng').value = p.lng || '';
    }

    document.getElementById('settings-form').addEventListener('submit', e => {
      e.preventDefault();
      const oldEmail = localStorage.getItem('currentUser');
      const all      = JSON.parse(localStorage.getItem('users') || '{}');
      const fn       = document.getElementById('profile-first-name').value.trim();
      const ln       = document.getElementById('profile-last-name').value.trim();
      const ne       = document.getElementById('profile-email').value.trim().toLowerCase();
      const ph       = document.getElementById('profile-phone').value.trim();
      const loc      = document.getElementById('profile-location').value.trim();
	  const lat = document.getElementById('profile-lat').value.trim();
const lng = document.getElementById('profile-lng').value.trim();
      if (ne !== oldEmail && all[ne]) {
        return alert('Email already in use');
      }
   const pw = document.getElementById('profile-password').value.trim();
const rec = {
  password: pw || all[oldEmail].password,
  profile: {
    firstName: fn,
    lastName: ln,
    email: ne,
    phone: ph,
    location: loc,
    lat: lat,
    lng: lng
  }
};

      delete all[oldEmail];
      all[ne] = rec;
      localStorage.setItem('users', JSON.stringify(all));
      localStorage.setItem('currentUser', ne);
      alert('Settings saved');
document.getElementById('profile-password').value = '';
    });

    document.getElementById('settings-logout').addEventListener('click', () => {
      localStorage.removeItem('currentUser');
      window.location.href = 'index.html';
    });
  </script>
  <script>
const locationInput = document.getElementById('profile-location');
const suggestionBox = document.getElementById('location-suggestions');
const latInput = document.getElementById('profile-lat');
const lngInput = document.getElementById('profile-lng');
const API_KEY = 'e4ba9531fa864ceaa8fdeab1d3da42c3'; // Replace this

let debounceTimer;
locationInput.addEventListener('input', () => {
  clearTimeout(debounceTimer);
  const query = locationInput.value.trim();
  if (query.length < 3) return;

  debounceTimer = setTimeout(() => {
    fetch(`https://api.opencagedata.com/geocode/v1/json?q=${encodeURIComponent(query)}&key=${API_KEY}&limit=1`)
      .then(res => res.json())
      .then(data => {
        if (data.results.length > 0) {
          const result = data.results[0];
          latInput.value = result.geometry.lat.toFixed(5);
          lngInput.value = result.geometry.lng.toFixed(5);
          suggestionBox.textContent = result.formatted;
        } else {
          latInput.value = '';
          lngInput.value = '';
          suggestionBox.textContent = 'No result found.';
        }
      })
      .catch(err => {
        console.error('Geocoding error:', err);
        suggestionBox.textContent = 'Error retrieving location.';
      });
  }, 400);
});
</script>


</body>
</html>